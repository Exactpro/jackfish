<project name="WEB" default="distribute">
	<property name="web.api.dir" location="../API" />
    <property name="web.release.dir"    location="release"      />
    <property name="web.source.dir"     location="src"          />
    <property name="web.lib.dir"     	location="libs"          />
    <property name="web.build.dir"      location="build"        />

    <target name="clean">
        <delete dir="${web.release.dir}"/>
        <mkdir  dir="${web.release.dir}"/>
        <delete dir="${web.build.dir}"/>
        <mkdir  dir="${web.build.dir}"/>
    </target>

	<target name="build.api" depends="clean" >
		<ant antfile="${web.api.dir}/build.xml" target="build" dir="${web.api.dir}">
		</ant>		
	</target>
	
	<path id="project.classpath">
		<fileset dir="${web.lib.dir}">
			<patternset includes="**/*.jar" excludes="oldselenium/*.jar" />
		</fileset>
		<fileset dir="${web.api.dir}/release">
			<patternset includes="**/*.jar" />
		</fileset>
	</path>

    <target name="compile" depends="build.api">
        <javac srcdir="${web.source.dir}" destdir="${web.build.dir}" debug="on">
			<classpath refid="project.classpath" />
    	</javac>
        <copy todir="${web.build.dir}">
            <fileset dir="${web.source.dir}">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>
	
	<target name="build" depends="compile">
		<echo>jar building...</echo>
		<jar destfile="${web.release.dir}/web.jar" basedir="${web.build.dir}">
			<manifest>
				<attribute name="Main-Class" value="org.eclipse.jdt.internal.jarinjarloader.JarRsrcLoader" />
				<attribute name="Rsrc-Main-Class" value="com.exactprosystems.jf.app.SeleniumRemoteApplication" />
				<attribute name="Class-Path" value="." />
				<attribute name="Rsrc-Class-Path" value="./  libs/api.jar libs/jetty-servlets-9.2.13.v20150730.jar libs/commons-collections-3.2.1.jar libs/jsoup-1.8.1.jar libs/jetty-security-9.2.13.v20150730.jar libs/selenium-java-2.48.2-srcs.jar libs/selenium-java-2.48.2.jar libs/jsp-api-2.0.jar libs/json-20080701.jar libs/htmlunit-core-js-2.17.jar libs/jetty-server-9.2.13.v20150730.jar libs/jetty-jmx-9.2.13.v20150730.jar libs/httpclient-4.5.1.jar libs/jasper-compiler-jdt-5.5.15.jar libs/cglib-nodep-2.1_3.jar libs/commons-lang3-3.4.jar libs/jcommander-1.48.jar libs/jar-in-jar-loader.zip libs/commons-exec-1.3.jar libs/apache-mime4j-0.6.jar libs/gson-2.3.1.jar libs/xercesImpl-2.11.0.jar libs/hamcrest-library-1.3.jar libs/operadriver-1.5.jar libs/xalan-2.7.2.jar libs/junit-4.12.jar libs/log4j-1.2.17.jar libs/commons-logging-1.2.jar libs/websocket-common-9.2.13.v20150730.jar libs/jetty-io-9.2.13.v20150730.jar libs/websocket-api-9.2.13.v20150730.jar libs/jasper-compiler-5.5.15.jar libs/serializer-2.7.2.jar libs/bsh-2.0b4.jar libs/cssparser-0.9.16.jar libs/testng-6.9.6.jar libs/jna-4.1.0.jar libs/htmlunit-2.18.jar libs/commons-codec-1.10.jar libs/jetty-servlet-9.2.13.v20150730.jar libs/nekohtml-1.9.22.jar libs/commons-io-2.4.jar libs/jetty-http-9.2.13.v20150730.jar libs/hamcrest-core-1.3.jar libs/jetty-continuation-9.2.13.v20150730.jar libs/phantomjsdriver-1.2.1.jar libs/guava-18.0.jar libs/jna-platform-4.1.0.jar libs/xml-apis-1.4.01.jar libs/websocket-client-9.2.13.v20150730.jar libs/javax.servlet-api-3.1.0.jar libs/jasper-runtime-5.5.15.jar libs/jetty-util-9.2.13.v20150730.jar libs/sac-1.3.jar libs/commons-el-1.0.jar libs/netty-3.5.7.Final.jar libs/httpmime-4.5.jar libs/httpcore-4.4.3.jar" />
			</manifest>	
            <fileset dir="${web.build.dir}" includes="**/*.class"/>
            <fileset dir="" includes="META-INF/services/*.*"/>
			<zipfileset src="${web.lib.dir}/jar-in-jar-loader.zip" />
			<zipfileset prefix="libs" dir="${web.api.dir}/release" includes="api.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-servlets-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-collections-3.2.1.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jsoup-1.8.1.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-security-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="selenium-java-2.48.2-srcs.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="selenium-java-2.48.2.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jsp-api-2.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="json-20080701.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="htmlunit-core-js-2.17.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-server-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-jmx-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="httpclient-4.5.1.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jasper-compiler-jdt-5.5.15.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="cglib-nodep-2.1_3.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-lang3-3.4.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jcommander-1.48.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jar-in-jar-loader.zip" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-exec-1.3.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="apache-mime4j-0.6.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="gson-2.3.1.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="xercesImpl-2.11.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="hamcrest-library-1.3.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="operadriver-1.5.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="xalan-2.7.2.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="junit-4.12.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="log4j-1.2.17.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-logging-1.2.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="websocket-common-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-io-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="websocket-api-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jasper-compiler-5.5.15.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="serializer-2.7.2.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="bsh-2.0b4.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="cssparser-0.9.16.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="testng-6.9.6.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jna-4.1.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="htmlunit-2.18.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-codec-1.10.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-servlet-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="nekohtml-1.9.22.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-io-2.4.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-http-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="hamcrest-core-1.3.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-continuation-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="phantomjsdriver-1.2.1.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="guava-18.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jna-platform-4.1.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="xml-apis-1.4.01.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="websocket-client-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="javax.servlet-api-3.1.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jasper-runtime-5.5.15.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="jetty-util-9.2.13.v20150730.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="sac-1.3.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="commons-el-1.0.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="netty-3.5.7.Final.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="httpmime-4.5.jar" />
			<zipfileset prefix="libs" dir="${web.lib.dir}" includes="httpcore-4.4.3.jar" />
		</jar>
	</target>
	
	<target name="distribute" depends="build">
		<copy todir="../ActionsLibrary/apps/">
			<fileset dir="${web.release.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
		<copy todir="../ActionsLibrary/testdata/resources/mock">
			<fileset dir="${web.release.dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
		<copydir src="drivers" dest="../ActionsLibrary/apps/"/>
	</target>
	

</project>